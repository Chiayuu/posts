<!DOCTYPE HTML>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <title>Shared Cost Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <style>
    /* light-only, minimal overrides that blend with Strata */
    :root{ --radius:12px; --gap:14px; }
    .wrap{max-width:980px;margin:0 auto;padding:18px;}
    .card{background:#fff;border:1px solid #eaeaea;border-radius:var(--radius);padding:14px;box-shadow:0 2px 16px rgba(0,0,0,.04);}
    .section{display:grid;grid-template-columns:1.2fr .8fr;gap:var(--gap);}
    .toolbar{position:sticky;top:0;z-index:5;background:rgba(255,255,255,.9);backdrop-filter:saturate(180%) blur(6px);border-bottom:1px solid #eee;}
    .toolbar .inner2{max-width:980px;margin:0 auto;display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px 18px;}
    .pill{display:inline-block;padding:.25rem .6rem;border-radius:999px;border:1px solid #e6e6e6;font-weight:600;background:#f7f7f7}
    .pill.ok{background:#e9f7ef;border-color:#d4efdf}
    .pill.warn{background:#fff6e6;border-color:#ffe0a3}
    form label{display:block;margin:.5rem 0 .25rem}
    input,select,button{width:100%;padding:.7rem .8rem;border:1px solid #ddd;border-radius:10px;font-size:1rem;background:#fff}
    button{cursor:pointer;background:#f5f5f5}
    button.primary{background:#111;color:#fff;border-color:#111}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:var(--gap)}
    .muted{color:#666}
    .table-wrap{overflow-x:auto;margin-top:12px}
    table{min-width:560px;width:100%;border-collapse:collapse}
    th,td{padding:.65rem;border-bottom:1px solid #eee;text-align:left}
    td.right,th.right{text-align:right}
    tfoot td{font-weight:700}
    @media (max-width: 880px){
      .section{grid-template-columns:1fr}
      .grid-2{grid-template-columns:1fr}
      .toolbar .inner2{gap:8px}
    }
  </style>
</head>
<body class="is-preload">
  <!-- Header (your original) -->
  <header id="header">
    <div class="inner">
      <h1><strong>CHIAYU's WEBSITE</strong></h1>
      <h1>An Engineer.</h1>
      <h1 align="right"><a href="https://chiayuu.github.io/"> HOME ■</a></h1>
      <h1 align="right"><a href="scloutline.html"> SCHOOL PROJECT ■</a></h1>
      <h1 align="right"><a href="selfoutline.html"> SELF PROJECT ■</a></h1>
      <h1 align="right"><b>SECRET PAGE ■</b></h1>
    </div>
  </header>

  <!-- sticky toolbar with badges -->
  <div class="toolbar">
    <div class="inner2">
      <div><b>Shared Cost Tracker</b></div>
      <div style="display:flex;gap:8px;align-items:center">
        <span>OVERALL: <span id="overallValue" class="pill warn">—</span></span>
        <span>STATUS: <span id="statusValue" class="pill warn">Loading…</span></span>
        <button id="refreshBtn" class="pill" type="button">🔄 Refresh</button>
      </div>
    </div>
  </div>

  <div id="main" class="wrap">
    <section id="one">
      <header class="major">
        <h2>💸 Shared Cost Tracker</h2>
        <p class="muted">輸入日期、項目、金額 → 寫入 Google Sheets；下方表格與上方 OVERALL/STATUS 由試算表同步顯示。</p>
      </header>

      <div class="section">
        <!-- left: input -->
        <div class="card">
          <h3 style="margin-top:0">新增一筆</h3>
          <form id="entryForm">
            <div class="grid-2">
              <div>
                <label>日期</label>
                <input type="date" id="dateInput" required />
              </div>
              <div>
                <label>金額</label>
                <input type="number" id="costInput" step="0.01" inputmode="decimal" placeholder="例如 12.50" required />
              </div>
              <div>
                <label>項目</label>
                <input type="text" id="itemInput" placeholder="Coffee / Uber ..." required />
              </div>
              <div>
                <label class="muted">狀態（若表單未建立可略）</label>
                <select id="statusInput" disabled>
                  <option value="">—</option>
                </select>
              </div>
            </div>
            <div style="display:flex;gap:10px;margin-top:10px">
              <button type="submit" class="primary">➕ 新增</button>
              <span id="msg" class="muted" aria-live="polite"></span>
            </div>
          </form>
          <p class="muted" style="margin:.6rem 0 0">送出後 1–2 秒自動更新；若未看到新資料請按 Refresh。</p>
        </div>

        <!-- right: quick overview -->
        <div class="card">
          <h3 style="margin-top:0">總覽</h3>
          <div class="grid-2">
            <div><b>合計（頁面）</b><br><span id="totalAll">$0.00</span></div>
            <div><b>可見列合計</b><br><span id="visibleSum">$0.00</span></div>
          </div>
          <p class="muted" style="margin-top:10px">
            OVERALL / STATUS 直接讀取分頁中的 E/F 欄（你的公式結果）。
          </p>
        </div>
      </div>

      <!-- table -->
      <div class="card" style="margin-top:var(--gap)">
        <h3 style="margin-top:0">所有項目</h3>
        <div class="table-wrap">
          <table id="dataTable" role="table">
            <thead>
              <tr><th>日期</th><th>項目</th><th class="right">金額</th></tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr><td colspan="2" class="right">合計：</td><td class="right" id="total">$0.00</td></tr>
            </tfoot>
          </table>
        </div>
      </div>
    </section>
  </div>

<script>
/* ====== your Google Form / Sheet config ====== */
const GOOGLE_FORM_ACTION = "https://docs.google.com/forms/d/e/1FAIpQLSd4fYEjOVAd4pqplNQPAVHjmNAfgHSuKATlyZjpPlLcxYlPEw/formResponse";
const FORM_FIELDS = {
  dateYear:  'entry.1832617978_year',
  dateMonth: 'entry.1832617978_month',
  dateDay:   'entry.1832617978_day',
  item:      'entry.1202275953',
  cost:      'entry.1361977771'
  // if you add a Status field later: status: 'entry.xxxxxxxxxx'
};
// IMPORTANT: publish the **Form_Responses2** tab → CSV and paste URL here:
const PUBLISHED_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQqlW9LOjG7ElOjhal3gZ1v3EKiXMiml-NFSsWH_fD3efz0-G4QYNJcT2woUl1iB5f5DUGMYrzbEYOd/pub?gid=1232924297&single=true&output=csv";
/* ============================================= */

const $
